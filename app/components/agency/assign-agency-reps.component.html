<mercury-loading
	[loading]="isLoading"
	[error]="isError"
	[errorMessage]="'Error loading rep info. Try again momentarily'"
	[results]="!!agency">
</mercury-loading>

<!-- Already-assigned reps -->
<div class="column-left" *ngIf="!isLoading">

	<!-- Assigned reps -->
	<h3>Agency reps</h3>
	<mat-list *ngIf="agency.reps.length">
		<mat-list-item class="list-item-alternating" matTooltip="Cannot be changed" matTooltipPosition="left"
			*ngIf="agency.primaryRep">
			<mat-icon mat-list-icon>star</mat-icon>
			<h3 class="text-primary" matLine>
				{{agency.primaryRep.name.last}}, {{agency.primaryRep.name.first}}
			</h3>
			<span class="text-secondary" matLine>
				Primary agency rep
			</span>
			<span class="text-hint" matLine>
				{{agency.primaryRep.email}}
			</span>

		</mat-list-item>
		<ng-container *ngFor="let user of agency.reps">
			<mat-list-item class="list-item-alternating" *ngIf="!isUserPrimaryRep(user);">
				<button mat-icon-button class="pull-right" color="warn" (click)="assign(user)"
					*ngIf="!isLoggedInUser(user)">
					<mat-icon>remove_circle_outline</mat-icon>
				</button>
				<h3 class="text-primary" matLine>{{user.name.last}}, {{user.name.first}}</h3>
				<span class="text-secondary" matLine>{{user.email}}</span>
			</mat-list-item>
		</ng-container>
	</mat-list>

	<div class="error-message text-center" *ngIf="!agency.reps.length">
		<mat-icon>not_interested</mat-icon>
		<p>No reps assigned</p>
	</div>
</div>

<div class="column-right">
	<!-- Search for reps -->
	<h3>Assign agency reps</h3>
	<mat-form-field class="expand">
		<span matPrefix>
			<mat-icon class="icon-inline">search</mat-icon>
		</span>
		<input matInput type="text" maxlength="64" [(ngModel)]="searchQuery"
			(keyup)="searchReps()" #searchField />
	</mat-form-field>

	<mercury-loading
		[loading]="isSearching"
		[error]="!agency"
		[results]="searchResults.length"
		[resultsMessage]="'No users found'">
	</mercury-loading>

	<mat-list class="fixed-height" *ngIf="searchResults.length">
		<mat-list-item class="list-item-alternating" *ngFor="let user of searchResults">
			<ng-container *ngIf="!isUserPrimaryRep(user);">
				<button mat-icon-button class="pull-right" (click)="assign(user)" *ngIf="!isUserAssigned(user)"
					color="primary">
					<mat-icon>add_circle_outline</mat-icon>
				</button>
				<button mat-icon-button class="pull-right" (click)="assign(user)" *ngIf="canRemoveUser(user);"
					color="warn">
					<mat-icon>remove_circle_outline</mat-icon>
				</button>
			</ng-container>

			<h3 class="text-primary" matLine>{{user.name.last}}, {{user.name.first}}</h3>
			<span class="text-secondary" matLine>{{user.email}}</span>
		</mat-list-item>
	</mat-list>
</div>
